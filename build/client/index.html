<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io.connect('http://localhost:6063');
  var pin;
  
  socket.on('connect', function () {
        console.log('connected');
        document.getElementById('ico-conn').style.visibility = '';
  });
  
  socket.on('pin', function (data) {
        console.log(data);
        pin = data.pin;
        document.getElementById('pin_display').textContent = pin;
  });
    
  socket.on('disconnect', function () {
        console.log('disconnected');
        document.getElementById('ico-good').style.visibility = 'hidden';
        document.getElementById('ico-conn').style.visibility = 'hidden';
  });
   
  socket.on('bc', function (data) {
        console.log(data);
        if (data.conn) {
            document.getElementById('connector').style.display = 'none';
            document.getElementById('connect?').style.display = 'none';
            document.getElementById('ico-good').style.visibility = '';
        }
  });
  
  socket.on('err', function (e) {
        console.log('err: ',e);
        if (e.pin) {
            console.log('pin error')
        }
  });
  
  function connect_show () {
      document.getElementById('connect?').style.display = 'none';
      document.getElementById('connector').style.visibility = '';
      document.getElementById('pin').value = '';
  }
  
  function connect_begin (inp) {
      if (!inp) {
            console.log('begin!');
            socket.emit('pin', { pin: pin });
      }
      else {
          var p = document.getElementById(inp).value;
          var p = parseInt(p);
          if (typeof p === 'number') {
            console.log('begin!');
            socket.emit('pin', { pin: p });
          }
      }
  }
</script>

<div>
    <span id='ico-good' style="font-family:Wingdings;visibility:hidden">&#x270c;</span>
    <span id='ico-conn' style="font-family:Wingdings;visibility:hidden">&#x27b0;</span> 
    <span id='ico-info' style="font-family:Wingdings" title="source">
        <a href="https://gitlab.com/chrisfgill/handsal/" target="blank">&#x1F419;</a>
    </span>
</div>

<div><span id='pin_display'></span></div>

<div id='connect?'>
    <a href="#connect_show" onclick="connect_show()">connect?</a>
</div>

<div id='connector' style='visibility:hidden'>
    <input id='pin' type='text'/>
    <br>
    <a href="#connect" onclick="connect_begin('pin')">connect</a>
    <br>
    <a href="#connect" onclick="connect_begin(null)">connect loopback</a>
</div>